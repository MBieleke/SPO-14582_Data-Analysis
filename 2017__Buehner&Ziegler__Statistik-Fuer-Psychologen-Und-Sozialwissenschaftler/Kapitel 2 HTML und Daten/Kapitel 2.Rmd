---
title: "Kapitel 2"
author: "Matthias Ziegler und Markus Bühner"
date: "15 9 2017"
output: 
  html_document:
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_float: yes
---

In diesem html Dokument finden sich Code und Ausgaben, wie sie in Kapitel 2 angegeben sind. Dabei beziehen wir uns nur auf die Abschnitte, die zeigen, wie Analysen in R vorgenommen werden.

#Kapitel 2
##Festlegen des Arbeitsverzeichnisses
```{r}
setwd("/Users/Matthias/Dropbox/Statistikbuch 2. Auflage/htmls")
```
##Daten einlesen
```{r}
library(foreign)
dat1 <- read.spss ("Kapitel 2.sav", to.data.frame=TRUE, use.value.labels=TRUE)
names(dat1)
head(dat1)
```

  
##Häufigkeitstabellen
```{r}
library(descr)
freq(ordered(dat1$sex))
freq(ordered(dat1$fach))
```
  
##Bildung neuer Kategorien
```{r}
dat1$Alter_Kategorie <- cut(dat1$age, breaks=c(-Inf, 21, 25, 29, 32, Inf),
labels=c("18-21","22-25","26-29","30-32","33 bis unendl."))
dat1$Alter_Kategorie <- factor(dat1$Alter_Kategorie)

round(freq(ordered(dat1$Alter_Kategorie)),2)
```

  
##Vorgehen in R (2.3)
###Deskriptive Statistiken
  Den Datensatz haben wir ja bereits eingelesen und das Arbeitsverzeichnis ist auch schon festgelegt. In den folgenden Codes wird der Datensatz jedoch im Objekt kap2 angelegt (im Buch). Dies legen wir im ersten Schritt fest
```{r}
kap2 <- dat1
vars <- kap2[, c("b", "lmi", "he")]
library(psych)
desc <- describe(vars, type = 2)
print(desc)
format(desc, digits=3)
```
  Exportieren der Tabelle
```{r}
library(xlsx)
write.xlsx(desc, "Deskriptive Statistiken.xlsx")
```

Hier noch eine schöne Tabelle für das HTML
```{r}
knitr::kable(x=desc, align = "c", caption="Tabelle 1. Deskriptive Statistiken", digits=2)
```

####Standardfehler zu Schiefe und Exzess
```{r}
library(pastecs)
desc2 <- stat.desc(vars, basic = TRUE, desc = TRUE, norm = TRUE, p=.95)
format(desc2, digits = 3)
```
  
###Standardisieren
```{r}
vars_z <- scale(vars, center=TRUE, scale=TRUE)
describe(vars_z)
```
  
###Grafische Darstellungen
####Histogramm
  Abb. 2.47a
```{r}
library(ggplot2)
Abb2.47a <- ggplot(kap2, aes(he))+geom_histogram(breaks=seq(.5,12.5, by=1), colour="Black", fill="dark green")
Abb2.47a+labs(x="Hoffnung auf Erfolg", y="Häufigkeit")+scale_x_continuous(breaks=seq(0,13, by=1))+scale_y_continuous(breaks=seq(0,15, by=1))

```

  Abb. 2.47b
```{r}
Abb2.47b <- ggplot(kap2, aes(he))
Abb2.47b+geom_histogram(aes(y=..density..), colour="black", fill="dark green", breaks=seq(.5,12.5, by=1))+scale_x_continuous(breaks=seq(0,13, by=1))+scale_y_continuous(breaks=seq(0,15, by=1))+stat_function(fun=dnorm, args=list(mean=mean(kap2$he), sd=sd(kap2$he)), colour="black")+labs(x="Hoffnung auf Erfolg", y="Dichte")

``` 
  
###Dichteplot
```{r}
Density <- ggplot(dat1, aes(age))
Density+geom_density(fill="Dark Green", colour="Black")+labs(x="Alter", y="Dichte")+ggtitle("Kerndichteschätzung")+scale_x_continuous(breaks=seq(15,40,1/1))

#Oder
qplot(age, data=dat1, geom="density")
```

  
  
###Polygon
```{r}
Polygon <- ggplot(dat1, aes(age))
Polygon+geom_freqpoly(binwidth=1,colour="Black", positon="identity")+labs(x="Alter", y="Anzahl")+ggtitle("Polygonzug")+scale_x_continuous(breaks=seq(15,40,1/1))
```
  
###Tortendiagramm
```{r}
sex.tab <- table(dat1$sex)
pie(sex.tab, main="Kreisdiagramm", labels=c("männlich", "weiblich"), col=c("darkgreen", "green"))
```
  
  
###Boxplot
```{r}
Box <- ggplot(dat1, aes(sex,age))
Box+geom_boxplot(outlier.size=3, outlier.shape=1, outlier.colour="Red",fill = "dark green", width=.3)+labs(x="Geschlecht", y="Alter in Monaten")
```
  
  Und nun verschiedene Alternativen.
  
###Alternativen
```{r}
{
boxplot(age~sex, data=dat1, xlab="Geschlecht", ylab="Alter in Monaten", range=1.5,boxwex=.3, col="Dark green")

#Abbildung 2.24
par(mfrow=c(2,1))
hist(dat1$age, main="Histogram", col="Dark Green", xlab="Alter", ylab="Häufigkeiten")
boxplot(dat1$age, data=dat1, xlab="Alter", ylab="Boxplot", range=1.5,boxwex=.3, col="Dark green", horizontal=TRUE)
#Abbildung 2.26
par(mfrow=c(1,1))
dat1$age_mon <- dat1$age*12
library(gplots)
plotmeans(age_mon~sex, data=dat1, mean.labels=FALSE, digits=2, col="dark green", p=.8431, connect=FALSE, ylab="Alter in Monaten",xlab="Geschlecht", main="Fehlerbalken +/-1 SD", n.label=FALSE)

dat1$age_mon <- dat1$age*12
library(ggplot2)
abb2.26 <- ggplot(dat1, aes(sex,age_mon))
abb2.26+stat_summary(fun.data=mean_sdl, geom="errorbar", width=.1)+
  labs(x="Geschlecht", y="Alter in Monaten")+
  stat_summary(fun.y=mean, geom="point", size=5)+
  theme(axis.text.x = element_text(size=15),axis.text.y = element_text(size=15),
        axis.title.x = element_text(size=20),axis.title.y = element_text(size=20))

library(psych)
describeBy(dat1, dat1$sex)
names(dat1)
#Abbildung 2.31
library(ggplot2)
scatter <- ggplot(dat1, aes(b, lmi))
scatter+geom_point()+labs(x="Baseline", y="Leistungsmotivationsindex")
scatter+geom_point()+labs(x="Baseline", y="Leistungsmotivationsindex")+geom_smooth(method="lm", se=FALSE)
scatter2 <- ggplot(dat1, aes(b, lmi, colour=sex))
scatter2+geom_point()+labs(x="Baseline", y="Leistungsmotivationsindex")+geom_smooth(method="lm", se=TRUE)

#Eine ALternative basierend auf R Base.
hist(kap2$he, breaks=seq(0,13, by=1), main="", xlab="Hoffnung auf Erfolg", ylab="Häufigkeiten", ylim=c(0,20), xlim=c(0,13), col="light blue",labels=TRUE)
}

```

  
##Deskriptive Statistiken und grafische Darstellungen (2.3.3)
###Perzentile
```{r}
lmi_per <- quantile(kap2$lmi, probs=c(.05, .1, .25, .5, .75, .9, .95))
lmi_per

lmi_per1 <- quantile(kap2$lmi, probs=seq(0,1, by=.05))
lmi_per1
```
  
###Deskriptive Statistiken
```{r}
library(psych)
descbygroup <- describeBy(vars, group = kap2$gruppe, type = 2)
descbygroup
```
  
####Gruppierte Balkendiagramme
```{r}
Abb2.49 <- ggplot(kap2, aes(he))+geom_histogram(breaks=seq(.5,12.5, by=1), colour="Black", fill="dark green")
Abb2.49+labs(x="Hoffnung auf Erfolg", y="Häufigkeit")+
  scale_x_continuous(breaks=seq(0,13, by=1))+scale_y_continuous(breaks=seq(0,15, by=1))+
  facet_wrap(~gruppe, ncol=3, nrow=1)+
  #Der folgende Code ändert noch die Schriftgröße
  theme(strip.text = element_text(size=20),
        axis.text.x = element_text(angle=90, size=11),axis.text.y = element_text(size=11),
        axis.title.x = element_text(size=20),axis.title.y = element_text(size=20))

```
  
####Test auf Normalverteilung
```{r}
sw <- by(data=kap2[, c("b", "lmi", "he", "fm")], INDICES = kap2$gruppe,
FUN = stat.desc, basic = FALSE, norm = TRUE)
sw

```
  
####Boxplots der Gruppen
```{r}
library(ggplot2)
Abb2.59 <- ggplot(kap2, aes(gruppe, lmi))
Abb2.59 + geom_boxplot(outlier.size = 3, outlier.shape = 1, outlier.colour =
"Black", fill = "dark green", width = .3) + labs(x = "Versuchsbedingungen",
y = "Leistungsmotivationsindex")
```
  
##Streudiagramme
###Mehrere Variablen
```{r}
vars2 <- kap2[c("b", "lmi", "he", "fm")]
library(psych)
pairs.panels(vars2, lm = TRUE, method = "pearson", hist.col = "darkgreen")
```
  
###Streudiagramm und Boxplot
```{r}
library(car)
scatterplot(lmi ~ b, data=kap2, smooth=FALSE, reg.line=lm, main="Streudiagramm in
R", xlab = "Baseline", ylab = "Leistungsmotivationsindex", id.method =
"identify", labels = row.names(kap2), boxplots = "xy")
```
  
###Streudiagramm und Konfidenzintervall
```{r}
library(ggplot2)
Abb2.65 <- ggplot(data=kap2, aes(x=b, y=lmi))
Abb2.65 + geom_point() + labs(x = "Baseline", y = "Leistungsmotivationsindex") +
geom_smooth(method = "lm", se = TRUE , level = .95)
```






