---
title: "Kapitel 1"
author: "Matthias Ziegler und Markus Bühner"
date: "15 9 2017"
output: 
  html_document:
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_float: yes
---

In diesem html Dokument finden sich Code und Ausgaben, wie sie in Kapitel 1 angegeben sind.

Es empfiehlt sich, bei allen Analysen in R zunächst das Arbeitsverzeichnis festzulegen.

#Kapitel 1
##Festlegen des Arbeitsverzeichnisses
```{r, warning=FALSE}
setwd("/Users/Matthias/Dropbox/Statistikbuch 2. Auflage/htmls")
```

##Einstieg in R
###Installation und Aktualisierung
####Exkurs: Updaten ohne Verlust der Pakete
```{r}
Pakete <- installed.packages()
installed_paks <- as.vector(Pakete[is.na(Pakete[,"Priority"]), 1])
save(installed_paks, file="Paketebibliothek.rda")
load("Paketebibliothek.rda")
#install.packages(installed_paks)

```
  
  Wir haben hier den letzten Befehl inaktiv geschalten durch das vorhergehende #, um beim Durchlaufen des Codes zu vermeiden, dass jedes Mal alle Pakete neu installiert werden.
  
##Grundbegriffe und wiederkehrende Schritte
```{r, warning=FALSE}
#install.packages(c("foreign", "car"))
```
  Auch hier haben wir den Befehl ausgeschalten

###Öffnen eines Pakets und Hilfefunktionen
```{r}
library("foreign")
?foreign
??foreign
```
  
  
###Daten einlesen und ein erster Überblick
```{r}
library(foreign)
data <- read.spss("LM Tests.sav", use.value.labels=FALSE, to.data.frame=TRUE, use.missings = TRUE)
names(data)
head(data)
tail(data)
data[c(1:3, 117:119),]
```
  Dies war die Option über ein SPSS Datenfile ohne das Nutzen der Variablenlable. Nun nutzen wir diese Option
  
  
```{r}
data2 <- read.spss("LM Tests.sav", use.value.labels=TRUE, to.data.frame=TRUE,
use.missings = TRUE)
data2[c(1:3, 117:119),]
```
  
  Wie man sieht, werden Variablen mit Labeln nun als Faktoren eingelesen.
  Es folgen weitere Beispiele mit anderen Datenformaten.
  
```{r}
# Daten als xlsx einlesen. Im ersten Schritt als xlsx speichern
library(xlsx)
write.xlsx(data, "LM Tests.xlsx")
data <- read.xlsx("LM Tests.xlsx", sheetIndex=1)
head(data)

# Daten als txt einlesen. Im ersten Schritt als txt speichern
write.table(data, file = "LM Tests.txt", sep = "\t")
lm<-read.table("LM Tests.txt", header=TRUE, sep="\t")
lm[1:10,]

head(lm)
```
  
###Daten oder Fälle auswählen
```{r}
library(psych)
names(lm)
describe(lm)
desc1 <- describe(lm$lmi)
desc1

```

  Variablen auswählen
  
```{r}
lm_var <- lm[c(3:6)]
lm_var <- lm[c("b", "lmi", "he", "fm")]
#oder
vars <- match(c("b", "lmi", "he", "fm"), names(lm))
lm_var <- lm[vars]
```
  
###Einzelne Fälle auslesen
```{r}
lmi_cases <- data2[50:75,]
describe(lmi_cases)

table(data2$sex)
lm_männer <- subset(data2, sex== "männlich")
describe(lm_männer)

lm_männer2 <- subset(data2, sex== "männlich" & lmi > 100)
describe(lm_männer2)

lm_om <- data2[complete.cases(data2$fach),]
describe(lm_om)
```
..
###Umkodieren
```{r}
ist <- read.spss("IST.sav", use.value.labels=FALSE, to.data.frame=TRUE, use.missings = TRUE)
names(ist)

describe(ist$aisr1040)
library(car)
ist$korrekt_40 <- recode(ist$aisr1040, "3=1; else=0")
describe(ist$korrekt_40)

#oder
ist[,c(1:20)] <- 1-ist[,c(1:20)]
```
  
###Exkurs: Elemente aus Objekten entnehmen
```{r}
library(psych)
desc1 <- describe(lm$lmi)
desc1
str(desc1)
sd <- desc1$sd

desc2 <- describeBy(lm$lmi, group=lm$sex)
str(desc2)
mean_men <- desc2$'1'[3]
mean_women <- desc2$'2'[3]
delta_mean <- mean_men-mean_women

delta_mean <- desc2$'1'[3]-desc2$'2'[3]
print(delta_mean)

es <- (desc2$'1'[3]-desc2$'2'[3])/desc1$sd
es <- delta_mean/sd
es
#oder
es2 <- (desc2$'1'["mean"]-desc2$'2'["mean"])/desc1$sd
es2
```
  
###Datenframe, Vektor und Faktor
```{r}
age <- subset(lm, select=age)

deskriptives <- subset(lm, select=c(age, sex))

age <- data$age
print(age)

```
  
  
###Faktorprüfung und -umwandlung
```{r}
is.factor(data$sex)

data$sex <- as.factor(data$sex)
is.factor(data$sex)

head(data)

data$sex <- factor(data$sex,levels=c(1,2), labels=c("männlich", "weiblich"))
head(data)

#oder
data$sex[data$sex==1] <- "männlich"
data$sex[data$sex==2] <- "weiblich"
head(data)

```

##Weitere Datentransformationen
  
###R als Taschenrechner
```{r}
2-7
17+12
30*4
2/8
13^4
sqrt(24/6)
```
  
###Summen- und Mittelwerte erstellen
```{r}
library(foreign)
library(psych)
ist <- read.spss("IST.sav", use.value.labels=FALSE, to.data.frame=TRUE, use.missings = TRUE)
names(ist)
describe(ist)
ist$Summe <- rowSums(ist, na.rm = T)
names(ist)
describe(ist$Summe)

ist_1 <- ist[c(1:10)]
ist$Summe1_10 <- rowSums(ist_1, na.rm = T)
describe(ist$Summe1_10)

ist$Mittelwert <- rowMeans(ist, na.rm = T)
names(ist)
describe(ist$Mittelwert)

```
  
##Exportieren von Ergebnissen
```{r}
library(psych)
descriptives <- describe(data)
library(xlsx)
write.xlsx(descriptives, "descriptives.xlsx")

sink("descriptives2.txt")
descriptives2 <- describeBy(data, group=data$gruppe)
print(descriptives2)
sink()
```



